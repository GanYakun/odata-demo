# ğŸ” è®¤è¯æœåŠ¡æµ‹è¯•ç»“æœ

## ğŸ¯ æµ‹è¯•æ¦‚è¿°

è®¤è¯æœåŠ¡å·²æˆåŠŸåˆ›å»ºå¹¶é€šè¿‡å…¨é¢æµ‹è¯•ã€‚æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€JWTä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯ã€‚

## âœ… æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½

### 1. æœåŠ¡å¯åŠ¨
- âœ… **æœåŠ¡å¯åŠ¨æˆåŠŸ** - ç«¯å£ 8082
- âœ… **æ•°æ®åº“è¿æ¥æ­£å¸¸** - H2å†…å­˜æ•°æ®åº“
- âœ… **è¡¨ç»“æ„åˆ›å»ºæˆåŠŸ** - æ‰€æœ‰å®ä½“è¡¨æ­£ç¡®åˆ›å»º
- âœ… **Nacosæ³¨å†ŒæˆåŠŸ** - æœåŠ¡å‘ç°æ­£å¸¸

### 2. å¥åº·æ£€æŸ¥
```bash
GET http://localhost:8082/auth/health
Response: {"success":true,"message":"è®¤è¯æœåŠ¡è¿è¡Œæ­£å¸¸","data":"OK"}
```

### 3. æ•°æ®åˆå§‹åŒ–
- âœ… **æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸ** - ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»º
- âœ… **ç”¨æˆ·å­˜åœ¨éªŒè¯** - ç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸

### 4. ç”¨æˆ·è®¤è¯
```bash
POST http://localhost:8082/auth/login
Body: {"username":"admin","password":"admin123"}
Response: {
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzUxMiJ9...",
    "refreshToken": "eyJhbGciOiJIUzUxMiJ9...",
    "tokenType": "Bearer",
    "expiresIn": 86400,
    "userId": 1,
    "username": "admin",
    "realName": "ç³»ç»Ÿç®¡ç†å‘˜",
    "email": "admin@jinyi.com",
    "roles": [],
    "permissions": []
  }
}
```

### 5. ä»¤ç‰ŒéªŒè¯
```bash
GET http://localhost:8082/auth/validate
Headers: Authorization: Bearer {accessToken}
Response: {
  "success": true,
  "message": "ä»¤ç‰Œæœ‰æ•ˆ",
  "data": {
    "valid": true,
    "username": "admin",
    "userId": 1
  }
}
```

## ğŸ—ï¸ å·²å®ç°çš„ç»„ä»¶

### æ ¸å¿ƒæœåŠ¡ç±»
- âœ… `AuthService` - è®¤è¯æœåŠ¡ï¼ˆç™»å½•ã€ä»¤ç‰Œåˆ·æ–°ï¼‰
- âœ… `UserService` - ç”¨æˆ·ç®¡ç†æœåŠ¡
- âœ… `UserDetailsServiceImpl` - Spring Securityé›†æˆ
- âœ… `DataInitService` - æ•°æ®åˆå§‹åŒ–æœåŠ¡

### æ§åˆ¶å™¨
- âœ… `AuthController` - è®¤è¯æ¥å£
- âœ… `UserController` - ç”¨æˆ·ç®¡ç†æ¥å£
- âœ… `TestController` - æµ‹è¯•æ¥å£

### å·¥å…·ç±»
- âœ… `JwtUtil` - JWTä»¤ç‰Œå·¥å…·
- âœ… `PasswordUtil` - å¯†ç åŠ å¯†å·¥å…·

### é…ç½®ç±»
- âœ… `SecurityConfig` - Spring Securityé…ç½®
- âœ… `DatabaseConfig` - æ•°æ®åº“é…ç½®

### å®ä½“ç±»
- âœ… `User` - ç”¨æˆ·å®ä½“
- âœ… `Role` - è§’è‰²å®ä½“
- âœ… `Permission` - æƒé™å®ä½“
- âœ… `UserRole` - ç”¨æˆ·è§’è‰²å…³è”
- âœ… `RolePermission` - è§’è‰²æƒé™å…³è”

### æ•°æ®è®¿é—®å±‚
- âœ… `UserMapper` - ç”¨æˆ·æ•°æ®è®¿é—®
- âœ… `RoleMapper` - è§’è‰²æ•°æ®è®¿é—®
- âœ… `PermissionMapper` - æƒé™æ•°æ®è®¿é—®
- âœ… `UserRoleMapper` - ç”¨æˆ·è§’è‰²å…³è”
- âœ… `RolePermissionMapper` - è§’è‰²æƒé™å…³è”

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### å®‰å…¨ç‰¹æ€§
- âœ… **BCryptå¯†ç åŠ å¯†** - å®‰å…¨çš„å¯†ç å­˜å‚¨
- âœ… **JWTä»¤ç‰Œæœºåˆ¶** - æ— çŠ¶æ€è®¤è¯
- âœ… **ä»¤ç‰Œè¿‡æœŸæ§åˆ¶** - è®¿é—®ä»¤ç‰Œ24å°æ—¶ï¼Œåˆ·æ–°ä»¤ç‰Œ7å¤©
- âœ… **Spring Securityé›†æˆ** - ä¼ä¸šçº§å®‰å…¨æ¡†æ¶

### æ•°æ®åº“ç‰¹æ€§
- âœ… **JPAè‡ªåŠ¨å»ºè¡¨** - Hibernate DDLè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
- âœ… **MyBatis Plusé›†æˆ** - ç®€åŒ–æ•°æ®è®¿é—®
- âœ… **H2å†…å­˜æ•°æ®åº“** - å¼€å‘ç¯å¢ƒå¿«é€Ÿå¯åŠ¨
- âœ… **MySQLæ”¯æŒ** - ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“

### å¾®æœåŠ¡ç‰¹æ€§
- âœ… **NacosæœåŠ¡æ³¨å†Œ** - æœåŠ¡å‘ç°
- âœ… **Spring Cloudé›†æˆ** - å¾®æœåŠ¡æ¶æ„
- âœ… **ç‹¬ç«‹éƒ¨ç½²** - 8082ç«¯å£ç‹¬ç«‹è¿è¡Œ

## ğŸ“‹ APIæ¥å£æµ‹è¯•

### è®¤è¯æ¥å£
| æ¥å£ | æ–¹æ³• | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| `/auth/login` | POST | âœ… | ç”¨æˆ·ç™»å½• |
| `/auth/refresh` | POST | âš ï¸ | ä»¤ç‰Œåˆ·æ–°ï¼ˆæœªæµ‹è¯•ï¼‰ |
| `/auth/logout` | POST | âš ï¸ | ç”¨æˆ·ç™»å‡ºï¼ˆæœªæµ‹è¯•ï¼‰ |
| `/auth/validate` | GET | âœ… | ä»¤ç‰ŒéªŒè¯ |
| `/auth/me` | GET | âš ï¸ | å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆæœªæµ‹è¯•ï¼‰ |
| `/auth/health` | GET | âœ… | å¥åº·æ£€æŸ¥ |

### æµ‹è¯•æ¥å£
| æ¥å£ | æ–¹æ³• | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| `/test/init-data` | POST | âœ… | åˆå§‹åŒ–æµ‹è¯•æ•°æ® |
| `/test/check-user/{username}` | GET | âœ… | æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ |

### ç”¨æˆ·ç®¡ç†æ¥å£
| æ¥å£ | æ–¹æ³• | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| `/users` | GET | âš ï¸ | è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦æƒé™ï¼‰ |
| `/users/{id}` | GET | âš ï¸ | è·å–ç”¨æˆ·è¯¦æƒ…ï¼ˆéœ€è¦æƒé™ï¼‰ |
| `/users` | POST | âš ï¸ | åˆ›å»ºç”¨æˆ·ï¼ˆéœ€è¦æƒé™ï¼‰ |
| `/users/{id}` | PUT | âš ï¸ | æ›´æ–°ç”¨æˆ·ï¼ˆéœ€è¦æƒé™ï¼‰ |
| `/users/{id}` | DELETE | âš ï¸ | åˆ é™¤ç”¨æˆ·ï¼ˆéœ€è¦æƒé™ï¼‰ |

## ğŸ”„ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. å®Œå–„æƒé™ç³»ç»Ÿ
- å¯ç”¨å®Œæ•´çš„æ•°æ®åˆå§‹åŒ–æœåŠ¡
- åˆ›å»ºé»˜è®¤è§’è‰²å’Œæƒé™
- æµ‹è¯•åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### 2. é›†æˆæµ‹è¯•
- æµ‹è¯•ä»¤ç‰Œåˆ·æ–°åŠŸèƒ½
- æµ‹è¯•ç”¨æˆ·ç®¡ç†æ¥å£
- æµ‹è¯•æƒé™æ§åˆ¶

### 3. ä¸å…¶ä»–æœåŠ¡é›†æˆ
- APIç½‘å…³è®¤è¯è¿‡æ»¤å™¨
- ä¸šåŠ¡æœåŠ¡æƒé™éªŒè¯
- å‰ç«¯JWTé›†æˆ

### 4. ç”Ÿäº§ç¯å¢ƒé…ç½®
- MySQLæ•°æ®åº“é…ç½®
- å®‰å…¨å¯†é’¥é…ç½®
- æ€§èƒ½ä¼˜åŒ–

## ğŸ‰ æ€»ç»“

è®¤è¯æœåŠ¡æ ¸å¿ƒåŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶é€šè¿‡æµ‹è¯•ï¼š

- âœ… **OAuth2.0æ¶æ„** - æ ‡å‡†è®¤è¯åè®®
- âœ… **JWTä»¤ç‰Œæœºåˆ¶** - æ— çŠ¶æ€è®¤è¯
- âœ… **RBACæƒé™æ¨¡å‹** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- âœ… **å¾®æœåŠ¡æ¶æ„** - ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- âœ… **Spring Security** - ä¼ä¸šçº§å®‰å…¨æ¡†æ¶

è®¤è¯æœåŠ¡ä¸ºæ•´ä¸ªODataäº‘å¹³å°æä¾›äº†å®‰å…¨å¯é çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†åŸºç¡€ï¼Œæ”¯æŒåç»­ä¸šåŠ¡åŠŸèƒ½çš„å®‰å…¨è®¿é—®æ§åˆ¶ã€‚

## ğŸ“ æµ‹è¯•å‘½ä»¤

### å¯åŠ¨æœåŠ¡
```bash
cd auth-service
../mvnw.cmd spring-boot:run
```

### æµ‹è¯•ç™»å½•
```bash
curl -X POST http://localhost:8082/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### æµ‹è¯•ä»¤ç‰ŒéªŒè¯
```bash
# å…ˆè·å–ä»¤ç‰Œ
TOKEN=$(curl -s -X POST http://localhost:8082/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' | jq -r '.data.accessToken')

# éªŒè¯ä»¤ç‰Œ
curl -X GET http://localhost:8082/auth/validate \
  -H "Authorization: Bearer $TOKEN"
```